
<!-- saved from url=(0102)https://azuresprintcommon.blob.core.windows.net/content/aksdevops/challenges/ko/challenge3/README.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>개요 - Sprint Series</title>
		
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="./개요 - Sprint Series_files/github-markdown.min.css" integrity="sha384-41TLk51mEPibuqZ3qC5guTOeo30Zt7UUaWLUn0/VdpGRO6b3SXA6AaKxj1mYzgAT" crossorigin="anonymous">
		<style>
				.markdown-body {
					box-sizing: border-box;
					min-width: 200px;
					max-width: 980px;
					margin: 0 auto;
					padding: 45px;
					background-color: #fff;
				}

				@media (max-width: 767px) {
					.markdown-body {
						padding: 15px;
					}
				}
		</style>
	</head>
	<body>
		<article class="markdown-body">
<p><img src="./개요 - Sprint Series_files/banner.png" alt="Azure Sprint Series Logo"></p>
<h1 id="도전-과제-3-azure-kubernetes-service-aks">도전 과제 3: Azure Kubernetes Service (AKS)</h1>
<p>이전 도전 과제에서는 단일 노드에 배포시 발생하는 몇몇 이슈를 강조했습니다. 노드 장애 또는 버그를 포함한 코드를 릴리스하는 경우, 업데이트된 코드를 배포할 때 가용성 목표를 침해하고 위험을 증가시킬 수 있습니다. 이 도전 과제에서는 컨테이너를 오케스트레이션하고 이런 문제에 대한 해결책을 제공하는 Azure Kubernetes Service(AKS)를 소개합니다.</p>
<p>Kubernetes는 컨테이너화된 애플리케이션의 배포, 확장/축소 및 관리 자동화를 위한 오픈 소스 솔루션으로, 고가용성 및 신축성을 제공하기 위해 프로덕션을 위한 애플리케이션에 대한 컨테이너 워크로드를 여러 컴퓨터에 걸쳐 쉽게 확장하는 방법을 제공합니다. Kubernetes는 자동화된 롤아웃, 자동화된 롤백, 자가 복구(self-healing), 로드 밸런싱, 서비스 탐색(service discovery) 등을 지원하는 플랫폼도 제공합니다.</p>
<p>Azure Kubernetes Service는 백엔드 인프라를 유지할 필요 없이 컨테이너 배포를 촉진시키면서 Kubernetes Cluster를 빨리 스핀업할 수 있도록 해주는 완전 관리형 Kubernetes 서비스입니다.</p>
<h1 id="exercise-1">Exercise 1</h1>
<p>작업 시작을 위해 Azure Kubernetes Service 실제 사용을 위한 리소스가 Azure Portal에 이미 설정되어 있습니다. Azure Kubernetes Service 배포와 관련된 일부 자원을 갖는 두 개의 리소스 그룹이 있으며, 여러분에게 새로울 수 있는 해당 그룹에 대한 주요 서비스는 아래에 요약되어 있습니다.</p>
<ul>
<li>관리 리소스 그룹 (-aks)<ul>
<li>Kubernetes Service: Kubernetes 클러스터 상태를 제어하며 Kubernetes Service에 대한 대부분의 설정은 이 자원을 통해 제어됩니다.</li>
<li>로그 분석 워크스페이스(Log Analytics Workspace): Azure 내에서 기능 감시 및 경보를 제공합니다.</li>
<li>가상 네트워크(Virtual Network): 클러스터를 구성하는 컴퓨터 사이의 네트워크 연결성을 제공합니다.</li></ul></li>
<li>노드 리소스 그룹 (-nodes)<ul>
<li>가상 머신 스케일 집합 (Virtual Machine Scale Set) 애플리케이션이 배포될 모든 가상 머신을 포함하는 자원입니다.</li>
<li>관리 아이덴티티(Managed Identities): 코드에 하드 코딩된 크리덴셜 없이 클라우드 서비스에 대해 Azure Services가 인증하는 것을 허용합니다.</li></ul></li>
</ul>
<p>Azure Kubernetes Service에 접속하려면 먼저 여러분의 신원(identity)을 증명하기 위해 Kubernetes로 인증할 Azure CLI 도구가 필요합니다. 다음으로, Kubernetes 클러스터에 대해 명령을 실행하는 오픈 소스 <code>kubectl</code> 유틸리티를 이용해야 합니다. 이 도구는 애플리케이션을 배포하고, 로그를 보며, 클러스터 자원을 조사할 수 있게 합니다.</p>
<p>이 연습을 통해, 여러분은 Azure Kubernetes Service에 접속하게 됩니다.</p>
<h2 id="task">Task</h2>
<ul>
<li>그룹에서 Azure Kubernetes Service 자원을 찾고 기본 노드 풀(에이전트 풀)이 3개의 머신에서 준비가 완료되었는지 확인합니다.</li>
<li><code>kubectl</code>을 설정해 Azure Kubernetes Service에 접속합니다.</li>
<li>Kubernetes 인스턴스에 접속되었는지 확인하고 <code>kubectl cluster-info</code> 명령을 실행합니다.</li>
</ul>
<h2 id="hints">Hints</h2>
<ul>
<li>여러분 머신에 Azure CLI를 설치할 권한이 없는 경우에는 Azure Cloud Shell을 사용하여 설치합니다.</li>
</ul>
<h2 id="유용한-리소스">유용한 리소스</h2>
<ul>
<li><a href="https://docs.microsoft.com/ko-kr/azure/aks/kubernetes-walkthrough?ocid=AID3042832#connect-to-the-cluster">Azure Kubernetes Service 클러스터에 접속</a></li>
<li><a href="https://kubernetes.io/ko/docs/reference/kubectl/overview/">kubectl 개요</a></li>
</ul>
<h1 id="kubernetes-개념">Kubernetes 개념</h1>
<p>애플리케이션을 Kubernetes로 옮기는 것을 계속하기 전에, 앞으로 진행될 사항에 대해 이해하는 데 중요한 핵심적인 Kubernetes 개념이 몇 가지 있습니다.</p>
<h2 id="노드">노드</h2>
<p>Azure Kubernetes Service는 애플리케이션을 클라우드에 있는 확장 가능한 일련의 가상 머신에서 실행시킵니다. 이런 가상 머신을 "노드"라고 하며 미리 설치되어 구성된 모든 Kubernetes 구성요소를 갖습니다.</p>
<h2 id="파드-pod">파드 (Pod)</h2>
<p>파드는 모든 Kubernetes 클러스터의 기본 구축 블록입니다. 가장 일반적인 사례로, 이러한 파드는 컨테이너를 감싸며 컨테이너가 실행되는 방법에 대한 측면(예: 명령행 인자, 환경 변수, 네트워킹 구성 방법 등)을 선언합니다. 파드를 컨테이너가 실행되는 일회용 환경으로 생각할 수 있습니다.</p>
<p>커맨드라인을 통해 파드를 수동으로 구성할 수 있지만, 이렇게 하지는 않을 텐데, 파드는 일시적인 것으로 자체적으로 치유되거나 확장될 수 없기 때문입니다. 파드는 프로세스가 종료되거나, 노드가 자원을 소진하거나 장애가 발생할 때 소멸됩니다. 그래서 파드는 "디플로이먼트"와 같은 워크로드 관리 컨트롤러에 의해 관리되는 것으로 보는 것이 훨씬 더 일반적입니다.</p>
<h2 id="디폴로이먼트-deployment">디폴로이먼트 (Deployment)</h2>
<p>디플로이먼트는 상태가 없는 애플리케이션이 Azure Kubernetes Service 내에서 어떻게 작동해야 하는지에 대한 원하는 상태를 설명하는 방법을 제공합니다. 이를 통해, 파드를 배포해야 하는 방법, 갱신 방법 그리고 확장 방법과 같은 수명주기 정보를 설명할 수 있게 됩니다. 디플로이먼트를 사용하면 애플리케이션에 대한 갱신 또는 롤백 프로세스 실행을 자동화할 수 있게 합니다.</p>
<h3 id="디플로이먼트-매니페스트-manifest">디플로이먼트 매니페스트 (Manifest)</h3>
<p>디플로이먼트를 정의하기 위해 커맨드라인으로 여러 명령을 수동으로 입력하는 대신 YAML 매니페스트로 원하는 디플로이먼트 상태를 기술할 수 있습니다. Kubernetes 클러스터는 이 YAML 매니페스트를 파싱해 여러분이 기술한 상태와 일치하도록 인프라를 자동으로 구성합니다.</p>
<h2 id="서비스">서비스</h2>
<p>디플로이먼트에는 여러 노드에 분할된 파드의 여러 리플리카도 종종 포함됩니다. 서비스는 해당 파드가 배포된 곳을 추적하지 않고도 파드와 통신을 허용하는 인터페이스를 제공합니다. 웹 디플로이먼트에서 일반적으로 사용되는 서비스는 로드 밸런서로 알려져 있습니다. 이 서비스는 외부 IP 주소에서 클러스터 내 백엔드 파드로의 수신 요청 균형을 잡아 부하가 각 서비스 사이에서 공유되도록 합니다.</p>
<h2 id="추가-정보">추가 정보</h2>
<p>이와 같은 개념에 대한 자세한 정보는 아래 "유용한 자원" 섹션에서 확인할 수 있습니다. 이와 같은 정보는 다음 도전 과제에도 도움이 될 수 있습니다.</p>
<h2 id="유용한-리소스-1">유용한 리소스</h2>
<ul>
<li><a href="https://docs.microsoft.com/ko-kr/azure/aks/concepts-clusters-workloads?ocid=AID3042832">Kubernetes 핵심 개념</a></li>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EC%9C%A0%EC%8A%A4%EC%BC%80%EC%9D%B4%EC%8A%A4">디플로이먼트 활용 사례</a></li>
<li><a href="https://azure.microsoft.com/ko-kr/overview/kubernetes-deployment-strategy/">Kubernetes 배포 전략</a></li>
</ul>
<h1 id="exercise-2">Exercise 2</h1>
<p>이제 Kubernetes의 일부 핵심적인 개념에 대해 학습했으니, 실전에 옮길 시간입니다.</p>
<p>이 연습을 통해, 여러분은 애플리케이션을 Kubernetes 인스턴스에 배포하고 각 파드 사이의 트래픽 균형을 잡는 로드 밸런서를 설정할 수 있게 됩니다.</p>
<h2 id="task-1">Task</h2>
<ul>
<li>ACR에서 애플리케이션 v1을 3개의 리플리카를 갖는 리플리카세트에 배포하는 디플로이먼트 매니페스트 파일을 생성합니다.</li>
<li>디플로이먼트 매니페스트 파일을 수정해 리플리카에 걸쳐 부하 균형을 잡는 서비스를 정의합니다.</li>
<li>Azure CLI 도구 및 kubectl을 이용해 클러스터에 접속한 후 디플로이먼트 매니페스트를 배포합니다.<ul>
<li>AKS 인스턴스가 인증할 수 있도록 ACR을 AKS 인스턴스에 부여해야 합니다.</li></ul></li>
<li>웹 브라우저를 이용해 애플리케이션에 접속해 모든 것이 기대한 대로 작동 중임을 확인합니다!</li>
</ul>
<h2 id="hints-1">Hints</h2>
<ul>
<li>트래픽 균형을 더 효과적으로 잡기 위해 Kubernetes가 여러 노드에 걸쳐 파드를 전개(spread)하는 힌트를 제공하기 때문에 서비스를 먼저 배포하는 것이 좋습니다.</li>
<li>kubectl 도구를 통해 이용할 수 있는 웹 인터페이스가 있다는 것을 눈치챘을 수 있습니다. 이 웹 인터페이스가 조사 및 작은 관리 작업에 유용할 수 있지만 상용 환경에서는 배포 구성 파일을 이용해 여러 환경 사이의 일관성을 확실히 유지하는 것을 권장합니다.</li>
<li>애플리케이션과 서비스를 배포했다면 <strong>'-nodes'</strong>로 끝나는 자원 그룹으로 이동해 이것을 테스트할 수 있습니다. <strong>로드 밸런서(Load balancer)</strong> 자원을 연 다음 <strong>프론트엔드 IP 구성(Frontend IP Configuration)</strong>을 엽니다. <strong>'kubernetes'</strong>를 포함하는 IP 주소를 사용하여 웹 브라우저로 엽니다.</li>
<li>다음은 디버깅할 때 유용한 명령어입니다:<ul>
<li><code>kubectl get pods</code></li>
<li><code>kubectl describe pod &lt;파드 이름&gt;</code></li></ul></li>
</ul>
<h2 id="유용한-리소스-2">유용한 리소스</h2>
<ul>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EB%94%94%ED%94%8C%EB%A1%9C%EC%9D%B4%EB%A8%BC%ED%8A%B8-%EC%83%9D%EC%84%B1">디플로이먼트 생성</a></li>
<li><a href="https://docs.microsoft.com/ko-kr/azure/aks/load-balancer-standard?ocid=AID3042832">AKS(Azure Kubernetes Service)에서 공용 표준 Load Balancer 사용</a></li>
<li><a href="https://docs.microsoft.com/ko-kr/azure/aks/cluster-container-registry-integration?ocid=AID3042832">ACR을 AKS 클러스터와 통합</a></li>
</ul>
<h1 id="exercise-3">Exercise 3</h1>
<p>디플로이먼트는 애플리케이션에 대한 최적의 상태를 정의하며, 이와 같이 필요성 또는 요구사항의 변경을 충족하기 위한 상태 수정이 매우 쉽습니다.</p>
<h2 id="task-2">Task</h2>
<ul>
<li>디플로이먼트를 4개의 리플리카로 확장합니다.</li>
<li>총 4개의 파드가 실행 중인지 확인합니다.</li>
<li>디플로이먼트를 다시 3개의 리플리카로 축소합니다.</li>
</ul>
<h2 id="유용한-리소스-3">유용한 리소스</h2>
<ul>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EB%94%94%ED%94%8C%EB%A1%9C%EC%9D%B4%EB%A8%BC%ED%8A%B8-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8">디플로이먼트 업데이트</a></li>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EB%94%94%ED%94%8C%EB%A1%9C%EC%9D%B4%EB%A8%BC%ED%8A%B8-%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81">디플로이먼트 스케일링</a></li>
<li><a href="https://kubernetes.io/ko/docs/reference/kubectl/cheatsheet/#%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81">리소스 스케일링</a></li>
</ul>
<h1 id="exercise-4">Exercise 4</h1>
<p>애플리케이션을 Kubernetes 클러스터에 배포했으므로, 이제 솔루션의 노드 복원성을 테스트할 때입니다. 마지막 도전 과제를 통해 노드 장애 시 중단이 있을 수 있다는 것을 확인했습니다. 이전 단계의 디플로이먼트를 이용해 노드 장애 시에도 계속 애플리케이션을 이용할 수 있게 하는 복원성 있는 구성을 가져야 합니다.</p>
<p>이 연습을 통해, 하나의 파드가 중지되었을 때 이전 연습에서의 디플로이먼트가 파드를 재구성하는 것에 대해 테스트하게 됩니다. 그 다음, 노드 장애를 시뮬레이션하고자 Azure CLI를 이용해 노드를 다시 시작할 수 있게 합니다. 두 경우에서 모두 새로운 파드는 지속되어야 하고 애플리케이션은 이용 가능한 상태를 유지해야 합니다.</p>
<h2 id="task-3">Task</h2>
<ul>
<li>kubectl을 이용해 파드 하나를 삭제하고 새로운 파드가 다시 생성되는지 확인합니다.</li>
<li>노드를 다시 시작해 클러스터가 파드를 다른 노드에서 다시 스케줄링하는지 확인합니다.</li>
<li>브라우저에서 애플리케이션을 보고 애플리케이션이 계속 실행 중인지 확인합니다.</li>
</ul>
<h2 id="hints-2">Hints</h2>
<ul>
<li><p>"aks"로 끝나는 자원 그룹을 열어 노드를 확장/축소하는 가상 머신 스케일 세트(Virtual Machine Scale set) 이름을 찾아볼 수 있습니다. 가상 머신 스케일 세트는 "-vmss"로 끝나는 자원입니다.</p></li>
<li><p>노드를 다시 시작하려면 다음 Azure CLI 명령을 사용해야 합니다:</p>
<p><code>az vmss restart --instance-ids 1 --name aks-agentpool-[scale_set_name]-vmss --resource-group [aks_resource_group_name]</code></p></li>
</ul>
<h2 id="유용한-리소스-4">유용한 리소스</h2>
<ul>
<li><a href="https://kubernetes.io/ko/docs/reference/kubectl/cheatsheet/">kubectl 치트 시트</a></li>
<li><a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/#using-kubectl-describe-pod-to-fetch-details-about-pods">애플리케이션 살펴보기 및 디버깅 (영문)</a></li>
</ul>
<h1 id="exercise-5">Exercise 5</h1>
<p>기존 디플로이먼트를 갱신하고 새로운 버전의 이미지를 파드에 기본으로 배포할 때, Kubernetes는 "롤링 업데이트"라는 것을 수행합니다. 이는 새로운 파드가 생성되고 이전 파드는 점진적으로 제거되면서 애플리케이션이 천천히 배포된다는 것을 의미합니다. 새로운 디플로이먼트 시작에 실패하면 문제가 해결될 때까지 이전 파드가 문제 없이 트래픽을 확실히 서비스할 수 있도록 롤아웃이 멈춥니다.</p>
<p>기본적으로 Kubernetes는 모든 컨테이너가 시작된 즉시 파드를 "준비됨(Ready)"으로 지정합니다. 컨테이너가 트래픽을 서비스할 준비가 된 때를 Kubernetes가 알게 하는 readiness probe를 정의함으로써 이 동작을 수정할 수 있습니다. 연결된 모든 서비스에서 이와 같은 readiness probe를 사용합니다. Readiness probe가 실패하면 서비스에 추가되지 않습니다.</p>
<p>이 연습을 통해, 배포 중 애플리케이션이 고가용성 상태를 유지하고, 트래픽을 서비스할 준비가 되었을 때에만 로드 밸런스 서비스에 추가되도록 readiness probe에 대해 정의할 수 있게 됩니다.</p>
<h2 id="task-4">Task</h2>
<ul>
<li>파드가 "ready"로 지정되기 전 30초 이내에 애플리케이션으로부터 두 개의 성공적 응답을 요구하는 readiness probe를 디플로이먼트에 정의합니다.</li>
<li>파손된 애플리케이션 버전을 롤아웃하고 브라우저를 점검해 애플리케이션이 계속 실행 중인지 확인합니다.</li>
<li>새로운 롤아웃 상태를 본 후 디플로이먼트를 동작하는 버전으로 롤백합니다.</li>
</ul>
<h2 id="유용한-리소스-5">유용한 리소스</h2>
<ul>
<li><a href="https://docs.microsoft.com/ko-kr/azure/application-gateway/ingress-controller-add-health-probes?ocid=AID3042832">서비스에 상태 프로브 추가</a></li>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EB%94%94%ED%94%8C%EB%A1%9C%EC%9D%B4%EB%A8%BC%ED%8A%B8-%EB%A1%A4%EB%B0%B1">디플로이먼트 롤백</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">Probe 구성하기 (영문)</a></li>
</ul>
<h1 id="exercise-6">Exercise 6</h1>
<p>파드가 원하는 대로 작동 중인지 확인하기 위해 일반적으로 사용하는 다른 probe가 있습니다. 이 probe는 "liveness probe"라 하며 애플리케이션이 교착 상태에 빠졌거나 완전 재시작을 요구하는 영구 파손 상태로 전환되지 않았는지 점검합니다.</p>
<p>이 연습을 통해, 애플리케이션이 일정 시간 동안 무응답 상태를 유지하는 경우 애플리케이션을 다시 시작하는 liveness probe에 대해 정의할 수 있게 됩니다.</p>
<h2 id="task-5">Task</h2>
<ul>
<li>애플리케이션이 5초마다 응답을 반환하는지 확인하는 liveness probe를 디플로이먼트에 생성합니다. 임계값에 도달하기 전에 이 probe가 15회 실패하도록 허용합니다.</li>
<li>파손된 애플리케이션 버전을 롤아웃하고 브라우저를 점검해 애플리케이션이 계속 실행 중인지 확인합니다.</li>
<li>새로운 롤아웃 상태를 본 후 디플로이먼트를 동작하는 버전으로 롤백합니다.</li>
</ul>
<h2 id="hints-3">Hints</h2>
<ul>
<li>다음 명령으로 파드 상태(재시작 횟수 포함)를 빨리 확인할 수 있습니다: <code>kubectl get pods</code></li>
</ul>
<h2 id="유용한-리소스-6">유용한 리소스</h2>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-a-liveness-http-request">HTTP liveness probe 정의하기 (영문)</a></li>
<li><a href="https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/#%EB%94%94%ED%94%8C%EB%A1%9C%EC%9D%B4%EB%A8%BC%ED%8A%B8-%EB%A1%A4%EB%B0%B1">디플로이먼트 롤백</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">Probe 구성하기 (영문)</a></li>
</ul>
<h1 id="마무리-단계">마무리 단계</h1>
<p>코치에게 다음 문제에 대해 준비되었음을 알리고, 궁금한 점이 있으실 경우 편히 질문해 보세요!</p>
		</article>
	
</body></html>